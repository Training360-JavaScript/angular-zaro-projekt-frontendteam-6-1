<h1>{{ tableConfig.title }}</h1>

<table
  mat-table
  [dataSource]="dataSource"
  matSort
  class="table mat-elevation-z8"
  *ngIf="dataSource.data.length > 0"
  cdkDropList cdkDropListOrientation="horizontal" (cdkDropListDropped)="drop($event)"
>

  <!-- data rows -->
  <ng-container *ngFor="let key of displayedColumnsKeys" cdkDropListGroup>
    <ng-container *ngIf="key !== 'buttons'" [matColumnDef]="key">

      <!-- header cell -->
      <th mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        XXXmatSortChange="announceSortChange($event)"
        cdkDrag
        cdkDragLockAxis="x"
        [title]="'Click to sort by '+tableConfig.columns[key].name+' or move to change column order'"
        sortActionDescription="'Sort by '+tableConfig.columns[key].name"
      >
        {{ tableConfig.columns[key].name }}
      </th>

      <!-- data cell -->
      <ng-container>
        <td mat-cell *matCellDef="let element">

          <ng-container *ngIf="tableConfig.columns[key].value; else pipe">
            {{ tableConfig.columns[key].value(element[ key ]) }}
          </ng-container>

          <ng-template #pipe>
            <ng-container  *ngIf="tableConfig.columns[key].pipe; else boolean">
              {{ element[ key ] | dynamic:tableConfig.columns[key].pipe }}
            </ng-container>
          </ng-template>

          <ng-template #boolean>
            <ng-container *ngIf="tableConfig.columns[key].type==='boolean'; else default">
              <mat-checkbox
                class="example-margin"
                [ngModel]="element[ key ]"
                disabled></mat-checkbox>
            </ng-container>
          </ng-template>

          <ng-template #default>
            {{ element[ key ] }}
          </ng-template>

        </td>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container [matColumnDef]="'buttons'">

    <th *matHeaderCellDef cdkDrag mat-header-cell>Buttons</th>

    <td mat-cell *matCellDef="let element">
      <button mat-button (click)="edit(element)">Edit</button>
      <button mat-button (click)="delete(element)">Delete</button>
    </td>

  </ng-container>


  <!-- filter row cells -->
  <ng-container matColumnDef="header-row-first-group">
    <ng-container *ngFor="let key of displayedColumnsKeys">
      <ng-container *ngIf="key !== 'buttons'" [matColumnDef]="key+'--filter'">

        <th mat-header-cell *matHeaderCellDef>

            <ng-container [ngSwitch]="tableConfig.columns[key].type">

              <mat-checkbox
                *ngSwitchCase="'boolean'"
                class="example-margin"
                [(ngModel)]="filter[key].value"
                [indeterminate]="filter[key].status === 'indeterminated'"
                (change)="setCheckBox(filter[key])"></mat-checkbox>

              <input class="w-100"
                *ngSwitchDefault
                [name]="key"
                type="text"
                [(ngModel)]="filter[key]"
                (keyup)="onChange()">

            </ng-container>

        </th>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container [matColumnDef]="'buttons--filter'">
    <th *matHeaderCellDef mat-header-cell></th>
    <td mat-cell *matCellDef="let element"></td>
  </ng-container>

  <!-- header and filter row -->
  <tr mat-header-row *matHeaderRowDef="displayedColumnsKeys; sticky:true;"></tr>
  <tr mat-header-row *matHeaderRowDef="displayedColumnsFilterKeys; sticky:true;"></tr>

  <!-- data table rows -->
  <tr mat-row *matRowDef="let row; columns: displayedColumnsKeys;"></tr>

</table>

<!-- paginator -->
<mat-paginator
  [pageSize]="10"
  [pageSizeOptions]="[10,25, 50, 100]"
  [length] = "dataSource.data.length"
  aria-label="Select page of periodic elements">
</mat-paginator>

